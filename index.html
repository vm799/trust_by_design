
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <title>JobProof | Professional Field Evidence</title>

  <!-- Favicon & App Icons -->
  <link rel="icon" type="image/svg+xml" href="/favicon.svg">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.svg">
  <link rel="manifest" href="/manifest.json">
  <meta name="theme-color" content="#2563EB">
  <meta name="description" content="End payment disputes forever. GPS-stamped photos, digital signatures, and tamper-proof job reports that get contractors paid.">
  <link rel="canonical" href="https://jobproof.pro/">

  <!-- Open Graph / Social Sharing -->
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://jobproof.pro/">
  <meta property="og:title" content="JobProof | Professional Field Evidence">
  <meta property="og:description" content="End payment disputes forever. GPS-stamped photos, digital signatures, and tamper-proof job reports that get contractors paid.">
  <meta property="og:image" content="https://jobproof.pro/og-image.svg">
  <meta property="og:site_name" content="JobProof">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="JobProof | Professional Field Evidence">
  <meta name="twitter:description" content="End payment disputes forever. GPS-stamped photos, digital signatures, and tamper-proof job reports that get contractors paid.">
  <meta name="twitter:image" content="https://jobproof.pro/og-image.svg">

  <!-- iOS PWA Support -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="JobProof">

  <!-- Content Security Policy - allows Google Fonts, Vercel, Supabase -->
  <!-- NOTE: frame-ancestors removed - it ONLY works in HTTP headers, not meta tags -->
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://vercel.live; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; font-src 'self' https://fonts.gstatic.com https://vercel.live; img-src 'self' data: blob: https:; connect-src 'self' https://*.supabase.co wss://*.supabase.co https://worldtimeapi.org https://fonts.googleapis.com https://fonts.gstatic.com https://vercel.live wss://vercel.live; worker-src 'self' blob:; frame-src 'self' https://vercel.live; base-uri 'self'; form-action 'self'">

  <!-- Fonts only - CSS is bundled by Vite -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap" rel="stylesheet">
  <style>
    /* Critical CSS - theme-aware, no horizontal scroll */
    html {
      overflow-x: hidden;
      max-width: 100vw;
    }
    html, body, #root {
      min-height: 100vh;
    }
    /* Default: light theme */
    html, body, #root {
      background-color: #ffffff;
    }
    body {
      font-family: 'Inter', sans-serif;
      overflow-x: hidden;
      max-width: 100vw;
      color: #0f172a; /* slate-900 */
    }
    /* Dark theme applied by ThemeProvider */
    html.dark, html.dark body, html.dark #root {
      background-color: #020617; /* slate-950 */
    }
    html.dark body {
      color: #f1f5f9; /* slate-100 */
    }
    #root {
      overflow-x: hidden;
      max-width: 100vw;
    }

    /* Prevent flash: detect system preference before React mounts */
    @media (prefers-color-scheme: dark) {
      html:not(.light):not(.daylight), html:not(.light):not(.daylight) body, html:not(.light):not(.daylight) #root {
        background-color: #020617;
      }
      html:not(.light):not(.daylight) body {
        color: #f1f5f9;
      }
    }

    /* Loading spinner shown before React mounts */
    #root:empty::after {
      content: '';
      position: fixed;
      top: 50%;
      left: 50%;
      width: 48px;
      height: 48px;
      border: 4px solid rgba(37, 99, 235, 0.3);
      border-top-color: #2563eb;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      transform: translate(-50%, -50%);
    }
    @keyframes spin { to { transform: translate(-50%, -50%) rotate(360deg); } }

    /* Additional styles */
    .glass { background: rgba(15, 23, 42, 0.8); backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.1); }
    .animate-in { animation: fadeIn 0.4s ease-out; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    * { font-style: normal !important; }
    input, select, textarea { font-size: 16px !important; }
    canvas { touch-action: none; }

    /* Print styles */
    @media print {
      .no-print, aside, nav, button:not(.print-allow) { display: none !important; }
      body { background: white !important; color: black !important; }
      img { print-color-adjust: exact; -webkit-print-color-adjust: exact; }
    }
  </style>

  <!-- Apply theme class before React mounts to prevent flash -->
  <script>
    (function() {
      try {
        var stored = localStorage.getItem('jobproof-theme-mode');
        var theme = stored ? JSON.parse(stored) : 'system';
        var daylight = localStorage.getItem('jobproof-daylight-enabled');
        if (daylight && JSON.parse(daylight)) {
          document.documentElement.classList.add('daylight');
        } else if (theme === 'dark') {
          document.documentElement.classList.add('dark');
        } else if (theme === 'light') {
          document.documentElement.classList.add('light');
        } else {
          // system preference
          if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
            document.documentElement.classList.add('dark');
          } else {
            document.documentElement.classList.add('light');
          }
        }
      } catch(e) {
        // Fallback: use system preference
        if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
          document.documentElement.classList.add('dark');
        }
      }
    })();
  </script>
</head>
<body class="antialiased">
  <div id="root"></div>
  <script type="module" src="/index.tsx"></script>

  <!-- Service Worker Registration for Bunker Mode (Offline-First) -->
  <script>
    if ('serviceWorker' in navigator) {
      // Listen for stale asset detection - auto-reload with guard to prevent infinite loops
      navigator.serviceWorker.addEventListener('message', (event) => {
        if (event.data && event.data.type === 'STALE_ASSETS_DETECTED') {
          console.log('[SW] Stale assets detected:', event.data.failedAsset);

          // Guard: Only reload once per session to prevent infinite loops
          const reloadKey = 'sw_stale_reload_attempted';
          const lastAttempt = sessionStorage.getItem(reloadKey);
          const now = Date.now();

          if (lastAttempt && (now - parseInt(lastAttempt, 10)) < 30000) {
            console.warn('[SW] Reload already attempted this session, skipping to prevent loop');
            return;
          }

          sessionStorage.setItem(reloadKey, now.toString());
          console.log('[SW] Triggering reload for stale assets...');
          window.location.reload(true);
        }
      });

      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/sw.js')
          .then((registration) => {
            console.log('[SW] Service Worker registered:', registration.scope);

            // Listen for updates
            registration.addEventListener('updatefound', () => {
              const newWorker = registration.installing;
              if (newWorker) {
                newWorker.addEventListener('statechange', () => {
                  if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                    console.log('[SW] New version available - refresh to update');
                  }
                });
              }
            });
          })
          .catch((error) => {
            console.warn('[SW] Service Worker registration failed:', error);
          });
      });
    }
  </script>
</body>
</html>
